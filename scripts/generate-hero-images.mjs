#!/usr/bin/env node

/**
 * Generate hero-images.ts from available park background images
 * Runs during build to auto-discover available hero backgrounds
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const PARKS_DIR = path.join(__dirname, '../public/images/parks');
const OUTPUT_FILE = path.join(__dirname, '../lib/hero-images.ts');

function getAllBackgroundImages() {
  const images = [];

  if (!fs.existsSync(PARKS_DIR)) {
    console.error('âŒ Parks directory not found:', PARKS_DIR);
    process.exit(1);
  }

  const parkDirs = fs
    .readdirSync(PARKS_DIR, { withFileTypes: true })
    .filter((dirent) => dirent.isDirectory())
    .map((dirent) => dirent.name);

  for (const parkDir of parkDirs) {
    const backgroundPath = path.join(PARKS_DIR, parkDir, 'background.jpg');

    if (fs.existsSync(backgroundPath)) {
      // Convert to web path
      const webPath = `/images/parks/${parkDir}/background.jpg`;
      images.push(webPath);
    }
  }

  return images.sort(); // Alphabetical order
}

function generateTypeScriptFile(images) {
  const content = `// Auto-generated by scripts/generate-hero-images.mjs
// DO NOT EDIT MANUALLY - Run 'pnpm build' or 'pnpm generate:hero-images' to regenerate

/**
 * Available hero background images for the homepage
 * Generated at build time from public/images/parks/[park]/background.jpg
 */
export const HERO_IMAGES = [
${images.map((img) => `  '${img}',`).join('\n')}
] as const;

export type HeroImage = typeof HERO_IMAGES[number];
`;

  return content;
}

function main() {
  console.log('ðŸŽ¨ Generating hero images list...');

  const images = getAllBackgroundImages();

  if (images.length === 0) {
    console.warn('âš ï¸  No park background images found!');
  } else {
    console.log(`âœ… Found ${images.length} hero images:`);
    images.forEach((img) => console.log(`   - ${img}`));
  }

  const content = generateTypeScriptFile(images);

  // Ensure lib directory exists
  const libDir = path.dirname(OUTPUT_FILE);
  if (!fs.existsSync(libDir)) {
    fs.mkdirSync(libDir, { recursive: true });
  }

  fs.writeFileSync(OUTPUT_FILE, content, 'utf8');
  console.log(`âœ… Generated ${OUTPUT_FILE}`);
}

main();
